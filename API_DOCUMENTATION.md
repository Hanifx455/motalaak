# توثيق واجهة برمجة التطبيق (API) لمنصة المتألق في التعليم

## نظرة عامة

هذا المستند يوثق واجهة برمجة التطبيق (API) الخاصة بمنصة "المتألق في التعليم" التعليمية. تتيح هذه الواجهة للمطورين الوصول إلى بيانات المنصة وإدارتها، بما في ذلك المستخدمين والدروس والاشتراكات.

## الرابط الأساسي

```
http://localhost:5000/api
```

## المصادقة

تتطلب معظم نقاط النهاية (endpoints) المصادقة باستخدام رمز JWT. يجب إرسال الرمز في ترويسة الطلب كالتالي:

```
Authorization: Bearer <token>
```

## نقاط النهاية المتاحة

### المستخدمين

#### تسجيل مستخدم جديد

- **طريقة الطلب**: POST
- **المسار**: `/users/signup`
- **المصادقة**: غير مطلوبة
- **البيانات المطلوبة**:
  ```json
  {
    "username": "اسم_المستخدم",
    "email": "example@example.com",
    "password": "كلمة_المرور",
    "passwordConfirm": "تأكيد_كلمة_المرور",
    "firstName": "الاسم_الأول",
    "lastName": "الاسم_الأخير",
    "educationLevel": "ابتدائي|متوسط|ثانوي|جامعي"
  }
  ```
- **الاستجابة الناجحة**:
  ```json
  {
    "status": "success",
    "token": "jwt_token",
    "data": {
      "user": {
        "id": "user_id",
        "username": "اسم_المستخدم",
        "email": "example@example.com",
        "role": "طالب"
      }
    }
  }
  ```

#### تسجيل الدخول

- **طريقة الطلب**: POST
- **المسار**: `/users/login`
- **المصادقة**: غير مطلوبة
- **البيانات المطلوبة**:
  ```json
  {
    "email": "example@example.com",
    "password": "كلمة_المرور"
  }
  ```
- **الاستجابة الناجحة**:
  ```json
  {
    "status": "success",
    "token": "jwt_token",
    "data": {
      "user": {
        "id": "user_id",
        "username": "اسم_المستخدم",
        "email": "example@example.com",
        "role": "طالب"
      }
    }
  }
  ```

#### الحصول على بيانات المستخدم الحالي

- **طريقة الطلب**: GET
- **المسار**: `/users/me`
- **المصادقة**: مطلوبة
- **الاستجابة الناجحة**:
  ```json
  {
    "status": "success",
    "data": {
      "user": {
        "id": "user_id",
        "username": "اسم_المستخدم",
        "email": "example@example.com",
        "firstName": "الاسم_الأول",
        "lastName": "الاسم_الأخير",
        "role": "طالب",
        "subscription": "مجاني",
        "educationLevel": "ابتدائي"
      }
    }
  }
  ```

### الدروس

#### الحصول على جميع الدروس

- **طريقة الطلب**: GET
- **المسار**: `/lessons`
- **المصادقة**: اختيارية (للوصول إلى الدروس المجانية فقط)
- **معلمات الاستعلام الاختيارية**:
  - `page`: رقم الصفحة (افتراضي: 1)
  - `limit`: عدد العناصر في الصفحة (افتراضي: 10)
  - `sort`: ترتيب النتائج (مثال: `-createdAt` للترتيب التنازلي حسب تاريخ الإنشاء)
  - `fields`: الحقول المطلوبة (مثال: `title,description,author`)
  - `educationLevel`: تصفية حسب المرحلة التعليمية
  - `subject`: تصفية حسب المادة الدراسية
  - `isPremium`: تصفية حسب نوع الدرس (مجاني أو مدفوع)
- **الاستجابة الناجحة**:
  ```json
  {
    "status": "success",
    "results": 2,
    "data": {
      "lessons": [
        {
          "id": "lesson_id_1",
          "title": "عنوان الدرس 1",
          "description": "وصف الدرس 1",
          "educationLevel": "ابتدائي",
          "subject": "رياضيات",
          "isPremium": false,
          "author": {
            "id": "author_id",
            "name": "اسم المؤلف"
          },
          "createdAt": "2023-07-15T00:00:00.000Z"
        },
        {
          "id": "lesson_id_2",
          "title": "عنوان الدرس 2",
          "description": "وصف الدرس 2",
          "educationLevel": "متوسط",
          "subject": "لغة عربية",
          "isPremium": true,
          "author": {
            "id": "author_id",
            "name": "اسم المؤلف"
          },
          "createdAt": "2023-07-20T00:00:00.000Z"
        }
      ]
    }
  }
  ```

#### الحصول على درس محدد

- **طريقة الطلب**: GET
- **المسار**: `/lessons/:id`
- **المصادقة**: مطلوبة للدروس المدفوعة
- **الاستجابة الناجحة**:
  ```json
  {
    "status": "success",
    "data": {
      "lesson": {
        "id": "lesson_id",
        "title": "عنوان الدرس",
        "description": "وصف الدرس",
        "content": "محتوى الدرس التفصيلي...",
        "educationLevel": "ابتدائي",
        "subject": "رياضيات",
        "grade": "الصف الأول",
        "isPremium": false,
        "author": {
          "id": "author_id",
          "name": "اسم المؤلف"
        },
        "videoUrl": "https://example.com/video.mp4",
        "attachments": [
          { "name": "ملف تمارين", "url": "https://example.com/exercises.pdf" }
        ],
        "duration": 45,
        "views": 120,
        "likes": 25,
        "comments": [
          {
            "user": { "id": "user_id", "name": "اسم المستخدم" },
            "text": "تعليق على الدرس",
            "createdAt": "2023-07-25T00:00:00.000Z"
          }
        ],
        "createdAt": "2023-07-15T00:00:00.000Z",
        "updatedAt": "2023-07-15T00:00:00.000Z"
      }
    }
  }
  ```

### الاشتراكات

#### الحصول على جميع خطط الاشتراك

- **طريقة الطلب**: GET
- **المسار**: `/subscriptions`
- **المصادقة**: غير مطلوبة
- **الاستجابة الناجحة**:
  ```json
  {
    "status": "success",
    "results": 3,
    "data": {
      "subscriptions": [
        {
          "id": "sub_id_1",
          "name": "مجاني",
          "price": 0,
          "currency": "DZD",
          "duration": 0,
          "features": [
            "الوصول إلى الدروس المجانية",
            "المشاركة في المنتدى",
            "إمكانية التعليق على الدروس"
          ],
          "description": "خطة مجانية تتيح الوصول إلى المحتوى الأساسي"
        },
        {
          "id": "sub_id_2",
          "name": "أساسي",
          "price": 500,
          "currency": "DZD",
          "duration": 30,
          "features": [
            "جميع مميزات الخطة المجانية",
            "الوصول إلى الدروس المتميزة",
            "تنزيل المرفقات",
            "اختبارات تفاعلية"
          ],
          "description": "خطة أساسية مناسبة للطلاب الراغبين في تحسين مستواهم"
        },
        {
          "id": "sub_id_3",
          "name": "احترافي",
          "price": 1200,
          "currency": "DZD",
          "duration": 30,
          "features": [
            "جميع مميزات الخطة الأساسية",
            "دروس خصوصية أسبوعية",
            "مراجعة الواجبات",
            "شهادات إتمام الدورات",
            "دعم فني على مدار الساعة"
          ],
          "description": "خطة احترافية شاملة للطلاب الجادين في التفوق الدراسي"
        }
      ]
    }
  }
  ```

#### الاشتراك في خطة

- **طريقة الطلب**: POST
- **المسار**: `/subscriptions/subscribe`
- **المصادقة**: مطلوبة
- **البيانات المطلوبة**:
  ```json
  {
    "planId": "sub_id_2",
    "paymentMethod": "بطاقة ائتمان|تحويل بنكي|دفع إلكتروني"
  }
  ```
- **الاستجابة الناجحة**:
  ```json
  {
    "status": "success",
    "data": {
      "subscription": {
        "id": "user_sub_id",
        "user": "user_id",
        "plan": "sub_id_2",
        "startDate": "2023-07-21T00:00:00.000Z",
        "endDate": "2023-08-20T00:00:00.000Z",
        "status": "نشط",
        "paymentMethod": "بطاقة ائتمان",
        "transactionId": "trans_id"
      }
    }
  }
  ```

## رموز الحالة

- `200 OK`: تم تنفيذ الطلب بنجاح
- `201 Created`: تم إنشاء المورد بنجاح
- `204 No Content`: تم تنفيذ الطلب بنجاح ولا توجد بيانات للإرجاع
- `400 Bad Request`: طلب غير صالح
- `401 Unauthorized`: المصادقة مطلوبة
- `403 Forbidden`: ليس لديك صلاحية للوصول إلى هذا المورد
- `404 Not Found`: المورد غير موجود
- `500 Internal Server Error`: خطأ في الخادم

## ملاحظات

- هذه الوثائق تمثل النسخة الأولية من واجهة برمجة التطبيق وقد تتغير في المستقبل.
- يجب تجديد رمز JWT كل 24 ساعة.
- للحصول على المساعدة، يرجى التواصل مع فريق الدعم الفني.